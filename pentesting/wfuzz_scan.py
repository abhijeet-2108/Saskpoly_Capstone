# pentesting/wfuzz_scan.py
import subprocess
import os
import re

def run_wfuzz_scan(target, scan_level):
    """
    Runs Wfuzz scan on the target with different scan levels.
    scan_level: "normal", "advanced", "extreme"
    """
    try:
        # Determine if target is IP or domain (simple regex for IP)
        is_ip = re.match(r"^\d{1,3}(\.\d{1,3}){3}$", target) is not None

        # Path to wordlists based on scan level
        wordlists_dir = "../Downloads"
        wordlist_file = ""
        if scan_level == "normal":
            wordlist_file = os.path.join(wordlists_dir, "common.txt")
        elif scan_level == "advanced":
            wordlist_file = os.path.join(wordlists_dir, "big.txt")
        elif scan_level == "extreme":
            wordlist_file = os.path.join(wordlists_dir, "raft-large-words.txt")
        else:
            return "Invalid scan level"

        # Basic Wfuzz command
        url = f"http://{target}/FUZZ" if is_ip else f"http://{target}/FUZZ"
        cmd = [
            "wfuzz",
            "-c",
            "-w", wordlist_file,
            url
        ]

        print(f"Running Wfuzz command: {' '.join(cmd)}")
        result = subprocess.check_output(cmd, text=True)
        return result

    except subprocess.CalledProcessError as e:
        return f"Wfuzz scan failed:\n{e.output}"
    except Exception as e:
        return f"Unexpected error:\n{e}"
